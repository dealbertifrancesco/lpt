% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/estimate_dose_slope.R
\name{estimate_dose_slope}
\alias{estimate_dose_slope}
\title{Estimate the dose-response slope via penalized splines}
\usage{
estimate_dose_slope(
  delta_y,
  dose,
  eval_points = NULL,
  k = 20,
  spline_bs = "cr"
)
}
\arguments{
\item{delta_y}{Numeric vector. First differences \eqn{\Delta Y_i}.}

\item{dose}{Numeric vector. Doses \eqn{D_i}. Same length as \code{delta_y}.}

\item{eval_points}{Numeric vector or NULL. Dose values at which to evaluate.
Default: 50 evenly spaced points from 5th to 95th percentile of dose.}

\item{k}{Integer. Number of spline basis functions (default: 20).
Reduced automatically if too large for the sample size.}

\item{spline_bs}{Character. Basis type: \code{"cr"} (cubic regression, default)
or \code{"tp"} (thin plate).}
}
\value{
A list of class \code{"dose_slope"} with components:
  \describe{
    \item{eval_points}{Dose grid used for evaluation.}
    \item{conditional_mean}{\eqn{\hat{E}[\Delta Y \mid D = d]} at each evaluation point.}
    \item{lambda_d}{\eqn{\hat{\lambda}(d)} â€” estimated derivative at each point.}
    \item{se_lambda}{Pointwise standard error of the derivative.}
    \item{gam_fit}{The fitted \code{mgcv::gam} object.}
  }
}
\description{
Fits a GAM to estimate \eqn{E[\Delta Y \mid D = d]} and its derivative
\eqn{\lambda(d) = \frac{\partial}{\partial d} E[\Delta Y \mid D = d]}
using cubic regression splines with REML smoothing parameter selection.
}
\details{
The derivative is computed via finite differencing of the prediction matrix
(lpmatrix). Standard errors use the delta method. See the package vignette
for theoretical details.
}
\examples{
data(sru)
ref <- sru[sru$year == 1999, ]
post <- sru[sru$year == 2019, ]
m <- merge(ref[, c("commune", "outcome", "dose")],
           post[, c("commune", "outcome")],
           by = "commune", suffixes = c("_ref", "_post"))
m$delta_y <- m$outcome_post - m$outcome_ref
result <- estimate_dose_slope(m$delta_y, m$dose)
plot(result$eval_points, result$lambda_d, type = "l")

}
